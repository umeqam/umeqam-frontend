<script>
const API_URL = "https://umeqamdream.vercel.app/analyze-dream";

const button = document.querySelector("button");
const textarea = document.querySelector("textarea");
const resultBox = document.querySelector(".result");

button.addEventListener("click", async () => {
  const dreamText = textarea.value.trim();

  if (!dreamText) {
    resultBox.innerHTML = "<p style='color:red'>Введите текст сна</p>";
    return;
  }

  resultBox.innerHTML = "⏳ Анализируем сон...";

  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        dream_text: dreamText
      })
    });

    if (!response.ok) {
      throw new Error("Ошибка сервера: " + response.status);
    }

    const data = await response.json();

    let html = "";

    if (data.analysis) {
      html += `<h3>Анализ</h3><p>${data.analysis}</p>`;
    }

    if (data.image_base64) {
      html += `<h3>Образ сна</h3>
               <img src="data:image/png;base64,${data.image_base64}" style="max-width:100%;border-radius:12px;">`;
    }

    resultBox.innerHTML = html || "Нет данных";

  } catch (err) {
    console.error(err);
    resultBox.innerHTML = "<p style='color:red'>Failed to fetch. Проверь backend.</p>";
  }
});
</script>
