<script>
async function analyzeDream() {
    const dream = document.getElementById('dreamText').value.trim();
    const resultDiv = document.getElementById('result');

    if (!dream) {
        resultDiv.innerHTML = "<p>Please enter a dream description.</p>";
        return;
    }

    resultDiv.innerHTML = "<p class='loading'>Analyzing dream‚Ä¶</p>";

    try {
        const response = await fetch("https://umeqam-dream.onrender.com/analyze-dream", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ dream_text: dream })
        });

        if (!response.ok) throw new Error("Service unavailable");

        const data = await response.json();
        renderResult(data);

    } catch (e) {
        // üîí LUXURY FALLBACK (–ª–µ—á–∏—Ç –≤—Å—ë)
        renderFallback(dream);
    }
}

function renderResult(data) {
    document.getElementById('result').innerHTML = `
        <h2>Dream Analysis</h2>
        <p><strong>Emotions:</strong> ${data.emotions}</p>
        <p><strong>Symbols:</strong> ${data.symbols}</p>
        <p><strong>Dynamics:</strong> ${data.dynamics}</p>
        <p><strong>Context:</strong> ${data.context}</p>
        <p><strong>Conclusion:</strong> ${data.conclusion}</p>
    `;
}

function renderFallback(dream) {
    document.getElementById('result').innerHTML = `
        <h2>Dream Analysis</h2>
        <p class="muted">
            Analysis service is temporarily unavailable.<br>
            The interface is functioning correctly.
        </p>

        <p><strong>Dream snapshot:</strong></p>
        <p>${dream.slice(0, 180)}${dream.length > 180 ? "‚Ä¶" : ""}</p>

        <p><em>This is a preview mode.</em></p>
    `;
}
</script>
